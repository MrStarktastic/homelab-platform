controllers:
  main:
    containers:
      main:
        env:
          TZ: "Asia/Jerusalem"
          PUID: "1000"
          PGID: "1000"

persistence:
  config:
    enabled: true
    type: persistentVolumeClaim
    storageClass: "nfs-pv"
    size: 1Gi
    accessMode: ReadWriteMany
    globalMounts:
      - path: /config

# =============================================================================
# IngressRoute Preset (via rawResources)
# =============================================================================
# Apps can enable these by setting in values.yaml:
#   ingressPreset:
#     enabled: true
#     type: internal | public
#     host: myapp.internal.starktastic.net
#     service:
#       name: myapp       # defaults to release name
#       port: 8080
#     auth: true          # add authentik-middleware
#     tls:
#       secretName: ""    # leave empty for default, or specify cert secret
# =============================================================================

ingressPreset:
  enabled: false
  type: internal
  host: ""
  service:
    name: ""
    port: 80
  auth: true
  rateLimitMiddleware: rate-limit-strong
  tls:
    secretName: ""

rawResources:
  ingressroute:
    enabled: '{{ .Values.ingressPreset.enabled }}'
    apiVersion: traefik.io/v1alpha1
    kind: IngressRoute
    spec:
      entryPoints:
        - '{{ eq .Values.ingressPreset.type "internal" | ternary "websec-int" "websecure" }}'
      routes:
        - match: 'Host(`{{ .Values.ingressPreset.host }}`)'
          kind: Rule
          services:
            - name: '{{ .Values.ingressPreset.service.name | default .Release.Name }}'
              port: '{{ .Values.ingressPreset.service.port }}'
          middlewares:
            - name: '{{ .Values.ingressPreset.rateLimitMiddleware }}'
              namespace: traefik-system
            {{- if .Values.ingressPreset.auth }}
            - name: authentik-middleware
              namespace: authentik
            {{- end }}
      tls:
        {{- if .Values.ingressPreset.tls.secretName }}
        secretName: '{{ .Values.ingressPreset.tls.secretName }}'
        {{- end }}
